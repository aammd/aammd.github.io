{
  "hash": "b34041fe996455374b06243a93ee3435",
  "result": {
    "markdown": "---\ntitle: \"Selection on plasticity\"\nauthor: \"Andrew MacDonald\"\ndescription: |\n  Stan model where a slope is also a prdictor\ndate: 11 Nov 2022\ncategories: [UdeS, stan, plasticity]\nexecute:\n  eval: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(targets)\nlibrary(ggplot2)\nlibrary(tidyverse)\nlibrary(tidybayes)\n# source(\"posts/2022-11-29-selection-on-plasticity/functions.R\")\n## functions for measuring selection on plasticity\nsimulate_many_moms <- function(pop_average_dponte = 138,\n                               mom_quality_max = 4,\n                               quality_on_dponte = 2,\n                               quality_on_csize = .2,\n                               n_females = 42,\n                               lifespan = 5,\n                               temp_range  = c(2, 12)) {\n\n  general_temp <- runif(lifespan, temp_range[1], max = temp_range[2])\n\n  general_temp_c <- general_temp - mean(general_temp)\n\n  mom_qualities <- runif(n_females, min = 0, max = 4)\n\n  many_moms_temperature <- expand_grid(year = 1:lifespan,\n                                       idF1 = 1:n_females) |>\n    mutate(mom_quality = mom_qualities[idF1],\n           general_temp = general_temp[year],\n           general_temp_c = general_temp_c[year],\n           ## adding the biology\n           ## Effect of temperature -- does it depend on quality? let's say that it DOES (for now)\n           effet_temp_dponte_qual = -.7*mom_quality,\n           effet_temp_csize_qual = .1*log(mom_quality),\n           # csize\n           mom_avg_csize = log(pop_average_csize) +  quality_on_csize*log(mom_quality),\n           temp_avg_csize = exp(mom_avg_csize + effet_temp_csize_qual*general_temp_c),\n           # dponte\n           mom_avg_dponte = pop_average_dponte + quality_on_dponte*mom_quality,\n           temp_avg_dponte = mom_avg_dponte + effet_temp_dponte_qual*general_temp_c,\n           ## observations\n           obs_csize = rpois(n = length(year), lambda = temp_avg_csize),\n           obs_dponte = rnorm(n = length(year), mean = temp_avg_dponte, sd = 3) |> round()\n    )\n  return(many_moms_temperature)\n}\n```\n:::\n\n\n## Model for measuring selection directly:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrue_corr_plasticity_avg <- .7\nsd_avg <- .9\nsd_plasticity <- .3\nn_females <- 47\n\ncorrmat <- matrix(c(1, true_corr_plasticity_avg, true_corr_plasticity_avg, 1),\n       byrow = TRUE, ncol = 2)\n\nvar_covar <- diag(c(sd_avg, sd_plasticity)) %*% corrmat %*% diag(c(sd_avg, sd_plasticity))\n\nfemale_avg_and_plasticity <- MASS::mvrnorm(\n  n = n_females,\n  mu = c(0,0),\n  Sigma = var_covar)\n```\n:::\n\n\nWe have the average and the slope for each female.\n\nFor a bit of extra realism, lets simulate several years and let the females belong to different cohorts. for simplicity, lets say each female lives for\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntwenty_years_environment <- runif(20, min = -3, max = 3)\n\nfemale_start_years <- sample(1:16, size = n_females, replace = TRUE)\nlibrary(tidyverse)\n\ndf <- tibble(\n  female_id = rep(1:n_females, each = 4),\n  year_id = rep(female_start_years, each = 4) + 0:3,\n  env = twenty_years_environment[year_id]\n)\n\ndf$env |> mean()\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}