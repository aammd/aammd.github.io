{
  "hash": "2fd367028eb834545df8eac79a2388f0",
  "result": {
    "markdown": "---\ntitle: \"Growth and size-dependent reproductive costs\"\nauthor: \"Andrew MacDonald\"\ndescription: |\n  Body size at first reproduction + costs of reproduction.\ndate: 11 Nov 2022\neditor: source\ncategories: [UdeS, stan]\ndraft: true\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(targets)\nlibrary(ggplot2)\nlibrary(tidyverse)\nlibrary(tidybayes)\n```\n:::\n\n\n## Why\n\nIs there a cost (to growth or final size) for reproducing? \nIs that cost lower if you are big when you start having babies?\n\nThis is about resource allocation not fitness.\n\nsimulate growth\n\n\n::: {.cell}\n\n```{.r .cell-code}\nr <- log(0.06)\nLmax <- 550\nLmin <- 1\nfake_mean <- tibble(age = 0:100, \n       leg = Lmin*(exp(-exp(r) * age)) + Lmax*(1 - exp(-exp(r) * age)))\n\n\nfake_mean |> \n  ggplot(aes(x =age, y = leg)) + \n  geom_point()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\nadd individual variation in growth rates\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn_indiv <- 30\nr_id <- rnorm(30, mean = 0, sd = .2)\n\nmany_animals <- expand_grid(id = 1:n_indiv, \n            age = 0:100) |> \n  mutate(\n    r_for_each = r_id[id],\n    indiv_grow = r + r_id[id],\n    leg = Lmin*(exp(-exp(indiv_grow) * age)) + \n      Lmax*(1 - exp(-exp(indiv_grow) * age)))\n\nmany_animals |> \n  ggplot(aes(x = age, y = leg, group = id)) + \n  geom_line() + \n  geom_vline(xintercept = 24, col = \"red\", lty=2)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\nOkay so suppose that all individuals reproduce at age 3 (36 months)\n\nReproduction comes with a cost: growth is reduced by 15%\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncost_repro <- log(1-.15)\n\n\nmany_animals_birth <- expand_grid(id = 1:n_indiv, \n            age = seq(from = 1 , to = 150, length.out = 600)) |> \n  mutate(\n    repro = if_else(age >= 36, 1, 0),\n    indiv_grow = r + r_id[id] + cost_repro*repro,\n    leg = Lmin*(exp(-exp(indiv_grow) * age)) + \n      Lmax*(1 - exp(-exp(indiv_grow) * age)))\n\n\nmany_animals_birth |> \n  ggplot(aes(x = age, y = leg, group = id)) + \n  geom_line() + \n  geom_vline(xintercept = 24, col = \"red\", lty=2)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n\n\n## Back to the drawing board!\n\nthe VB equation has parameters made of three parts. let's break it up\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# grams per cm^3 of roo\ndens <- 3200/(53)^3\n# anabolism scaling with square length\nana_scale <- (3200/12)/(53^2)\ncata_scale <- (3200/12)/(53^3)\n\nvb_breakdown <- function(t, ana, cata, dens, Lo){\n  r <- cata/(3 * dens)\n  Lmax <- ana / cata\n  Lo * (exp(-r * t)) + Lmax * (1 - exp(-r * t))\n  \n}\n\ncurve(vb_breakdown(t = x, ana = ana_scale, cata = cata_scale, dens = dens, Lo = 1), xlim = c(0, 150))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\nNow try with a varying input per year\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlog(ana_scale)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -2.354584\n```\n:::\n\n```{.r .cell-code}\nyear_rates <- rnorm(n = 20, mean = -2.35, sd = .05)\n\ntibble(t = 1:240,\n       year_ana = year_rates |> rep(each = 12),\n       leg = vb_breakdown(t = t,\n                          ana = exp(year_ana),\n                          cata = cata_scale,\n                          dens = dens, \n                          Lo = 1)) |> \n  ggplot(aes(x = t, y = leg)) + geom_point()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nyikes. what if growth is discrete:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsize <- rep_along(year_rates, list())\nsize[1] <- vb_breakdown(t = 12,\n                        ana = exp(year_rates[1]),\n                        cata = cata_scale,\n                        dens = dens, \n                        Lo = 1.3)\n\nfor ( y in 2:length(size)){\n  size[y] <- vb_breakdown(t = 12,\n                          ana = exp(year_rates[y]),\n                          cata = cata_scale,\n                          dens = dens, \n                          Lo = size[[y-1]])\n}\n\ntibble(age = seq(from = 12, to = length(size)*12, by = 12),\n       leg = size |> \n         flatten_dbl()) |> \n  ggplot(aes(x = age, y = leg)) + \n  geom_point()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\nlet catabolism vary instead\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlog(cata_scale)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -6.324876\n```\n:::\n\n```{.r .cell-code}\ncata_yr <- rnorm(n = 20, mean = log(cata_scale), sd = .05)\n\nsize <- rep_along(cata_yr, list())\nsize[1] <- vb_breakdown(t = 12,\n                        ana = ana_scale,\n                        cata = exp(cata_yr[1]),\n                        dens = dens, \n                        Lo = 1.3)\n\nfor ( y in 2:length(size)){\n  size[y] <- vb_breakdown(t = 12,\n                          ana = ana_scale,\n                          cata = exp(cata_yr[y]),\n                          dens = dens, \n                          Lo = size[[y-1]])\n}\n\ntibble(age = seq(from = 12, to = length(size)*12, by = 12),\n       leg = size |> \n         flatten_dbl()) |> \n  ggplot(aes(x = age, y = leg)) + \n  geom_point()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n* plot with discrete model, even if continuous was fit\n* potentially fit with discrete form (and of course plot with it also)\n* use L(age  = 24) within the equation with its own coefficient\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}