{
  "hash": "bfdb08bb17b97f5d4e7fb2b2399b222b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Contrasts\"\nauthor: \"Andrew MacDonald\"\ndescription: |\n  What's the (kind of) difference?\ndate: 14 Dec 2023\ncategories: [UdeS, stan]\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(targets)\nlibrary(ggplot2)\nlibrary(tidyverse)\nlibrary(tidybayes)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmeans <- c(3,4,9)\n\nneach <-  25\nys <- rnorm(n = neach*length(means), mean = rep(means, each = neach), sd = .3)\nxs <- rep(letters[1:length(means)], each = neach)\n\nmod <- lm(ys ~ xs)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nxs <- as.factor(xs)\n\ncontrasts(xs) <- contr.helmert(3)\ncontrasts(xs) <- sweep(contr.helmert(3), MARGIN = 2, STATS = 2:3, FUN = `/`)\n\nsweep(matrix(1, nrow = 4, ncol = 3), MARGIN = 2,STATS = 1:3, FUN =  `/`)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     [,1] [,2]      [,3]\n[1,]    1  0.5 0.3333333\n[2,]    1  0.5 0.3333333\n[3,]    1  0.5 0.3333333\n[4,]    1  0.5 0.3333333\n```\n\n\n:::\n\n```{.r .cell-code}\nmod_helm <- lm(ys ~ xs)\n\nsummary(mod_helm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = ys ~ xs)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.56666 -0.18801 -0.03627  0.17782  0.62273 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  5.29433    0.03218  164.50   <2e-16 ***\nxs1          1.13516    0.07883   14.40   <2e-16 ***\nxs2          5.48811    0.06827   80.39   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.2787 on 72 degrees of freedom\nMultiple R-squared:  0.9893,\tAdjusted R-squared:  0.989 \nF-statistic:  3335 on 2 and 72 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n\n```{.r .cell-code}\nmean(ys)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 5.294333\n```\n\n\n:::\n\n```{.r .cell-code}\nmeans[2] - means[1]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1\n```\n\n\n:::\n\n```{.r .cell-code}\nmeans[3] - mean(means[1:2])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 5.5\n```\n\n\n:::\n:::\n\n\n## Helmert contrasts\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsuppressPackageStartupMessages(library(tidyverse))\n\n# plot the means\n\nhh <- coef(mod_helm)\n\ncc <- RColorBrewer::brewer.pal(3, \"Set2\")\n\n\nhelmert <- tibble(xs, ys) |> \n  ggplot(aes(x = xs, y= ys)) + \n  geom_point() + \n  stat_summary(fun.data = mean_cl_normal, col = \"red\") + \n  geom_segment(aes(x = 1.5,\n                   xend = 1.5,\n                   y = means[1],\n                   yend = means[1] + hh[2]),\n               lwd = 4, col = cc[2]) + \n  geom_segment(x = .9, xend = 3.1, \n               yend = hh[1], \n               y = hh[1], lwd = 4, col = cc[1]) + \n  geom_segment(aes(x = 1, xend = 3,\n                   y = mean(means[1:2]),\n                   yend =  mean(means[1:2])), lty = 2) + \n  geom_segment(aes(x = 2.5, xend = 2.5,\n                   y = mean(means[1:2]), \n                   yend = mean(means[1:2]) + hh[3]),\n               col = cc[3], lwd = 4)\n\nhelmert\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Computation failed in `stat_summary()`\nCaused by error in `fun.data()`:\n! The package \"Hmisc\" is required.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nbuild a group of 3 this way:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncontr.helmert.unscaled <- function(n){\n   sweep(contr.helmert(n), MARGIN = 2, STATS = 2:n, FUN = `/`)\n}\n\ncmat <- contr.helmert.unscaled(3)\n\n\ngrand_mean <- 7\ndiff_parents <- .5\nnonadd_hybrid <- 3\n\ngeno_simulation <- tibble(geno_name = c(\"H\", \"N\", \"HN\"),\n       geno_id = 1:3,\n       n = 15) |>\n  uncount(n) |> \n  mutate(b0 = 1, \n         b1 = cmat[geno_id, 1], \n         b2 = cmat[geno_id, 2],\n         avg = b0 * grand_mean + b1 * diff_parents + b2*nonadd_hybrid,\n         obs = rnorm(length(avg), mean = avg, sd = .3))\n  \ngeno_simulation |> \n  ggplot(aes(x = geno_name, y = obs)) + \n  geom_point()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n## default contrasts\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmeans <- c(3,4,9)\n\nneach <-  25\nys <- rnorm(n = neach*length(means), mean = rep(means, each = neach), sd = .3)\nxs <- rep(letters[1:length(means)], each = neach)\n\nmod <- lm(ys ~ xs)\n\ncoefs_trt <- coef(mod)\n\ntreatment <- tibble(xs, ys) |> \n  ggplot(aes(x = xs, y= ys)) + \n  geom_point() + \n  stat_summary(fun.data = mean_cl_normal, col = \"red\") + \n  geom_segment(x = .9, xend = 3.1, \n               yend = coefs_trt[1], \n               y = coefs_trt[1], lwd = 4, col = cc[1]) + \n  geom_segment(x = 2.1,\n               xend = 2.1,\n               y = coefs_trt[1],\n               yend = coefs_trt[1] + coefs_trt[2],\n               lwd = 4, col = cc[2]) + \n  geom_segment(x = 3.1, \n               xend = 3.1,\n               y = coefs_trt[1], \n               yend = coefs_trt[1] + coefs_trt[3],\n               col = cc[3], lwd = 4)\n\ntreatment\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Computation failed in `stat_summary()`\nCaused by error in `fun.data()`:\n! The package \"Hmisc\" is required.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n## Polynomial contrasts\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmeans <- c(3,4,9)\n\nneach <-  25\nys <- rnorm(n = neach*length(means), mean = rep(means, each = neach), sd = .3)\nxs <- ordered(rep(letters[1:length(means)], each = neach))\n\nmod <- lm(ys ~ xs)\n\ncontr_vals <- contrasts(xs)\n\ncoefs_lin <- coef(mod)\n\npolyfig <- tibble(xs, ys) |> \n  ggplot(aes(x = xs, y= ys)) + \n  geom_point() + \n  stat_summary(fun.data = mean_cl_normal, col = \"red\") + \n  geom_segment(x = 1, y = coefs_lin[1], xend = 3, yend = coefs_lin[1], lwd = 4, col = cc[1]) + \n  geom_line(aes(x = x, y = y), \n            data = data.frame(x = 1:3,\n                              y = contr_vals[,1][]*coefs_lin[2] + coefs_lin[1]),\n            lwd = 4, col = cc[2]) + \n  geom_line(aes(x = x, y = y), \n            data = data.frame(x = 1:3,\n                              y = contr_vals[,2][]*coefs_lin[3] + coefs_lin[1]),\n            lwd = 4, col = cc[3])\n\npolyfig\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Computation failed in `stat_summary()`\nCaused by error in `fun.data()`:\n! The package \"Hmisc\" is required.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n### sum contrasts\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmeans <- c(3,4,9)\n\nneach <-  25\nys <- rnorm(n = neach*length(means), mean = rep(means, each = neach), sd = .3)\nxs <- factor(rep(letters[1:length(means)], each = neach))\ncontrasts(xs) <- contr.sum(3)\nmod <- lm(ys ~ xs)\nsummary(mod)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = ys ~ xs)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.54245 -0.18690  0.02279  0.18022  0.88346 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  5.32356    0.03108  171.31   <2e-16 ***\nxs1         -2.34976    0.04395  -53.47   <2e-16 ***\nxs2         -1.28808    0.04395  -29.31   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.2691 on 72 degrees of freedom\nMultiple R-squared:  0.9899,\tAdjusted R-squared:  0.9896 \nF-statistic:  3523 on 2 and 72 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n\n```{.r .cell-code}\ncoefs_sum <- coef(mod)\n\ncontrsum <- tibble(xs, ys) |> \n  ggplot(aes(x = xs, y= ys)) + \n  geom_point() + \n  stat_summary(fun.data = mean_cl_normal, col = \"red\") + \n  geom_segment(x = .9, xend = 3.1, y = coefs_sum[1], yend = coefs_sum[1],\n               lwd = 4, col = cc[1]) +  \n  geom_segment(x = 1.1,\n               xend = 1.1,\n               y = coefs_sum[1],\n               yend = coefs_sum[1] + coefs_sum[2],\n               lwd = 4, col = cc[2]) + \n  geom_segment(x = 2.1, \n               xend = 2.1,\n               y = coefs_sum[1], \n               yend = coefs_sum[1] + coefs_sum[3],\n               col = cc[3], lwd = 4)\ncontrsum\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Computation failed in `stat_summary()`\nCaused by error in `fun.data()`:\n! The package \"Hmisc\" is required.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(patchwork)\n\n\n(\n  (treatment + \n     labs(title = \"Treatment\") + \n     theme(axis.title = element_blank())\n   ) + contrsum +\n     labs(title = \"Sum\") + \n    theme(axis.title = element_blank())\n) / (\n  (helmert +\n     labs(title = \"Helmert\") + \n     theme(axis.title = element_blank())) +\n    (polyfig +\n     labs(title = \"Polynomial\") + \n     theme(axis.title = element_blank()))\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Computation failed in `stat_summary()`\nComputation failed in `stat_summary()`\nComputation failed in `stat_summary()`\nComputation failed in `stat_summary()`\nCaused by error in `fun.data()`:\n! The package \"Hmisc\" is required.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/final-figure-1.png){width=864}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}