{
  "hash": "f8765944eb6945c31e6cf8d553eb62f4",
  "result": {
    "markdown": "---\ntitle: \"Modelling occupancy plus phenology\"\nauthor: \"Andrew MacDonald and Gabriel Bergeron\"\ndescription: |\n  Are they really there and when.\ndate: 11 Nov 2022\ncategories: [UdeS, stan]\nexecute:\n  eval: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(targets)\nlibrary(ggplot2)\nlibrary(tidyverse)\nlibrary(tidybayes)\n```\n:::\n\n\n## occupancy models\n\n$$ \n\\begin{align}\nPr(y = 1) &= \\text{Bernoulli}(wp) \\\\\nw &= 1 - (1 - d)^{\\text{effort}} \\\\\n\\text{logit}(p) &= \\alpha \\\\\n\\text{logit}(d) &= \\beta \\\\\n\\alpha &\\sim \\text{N}(-1,0.5) \\\\\n\\beta &\\sim \\text{N}(0,0.5) \\\\\n\\end{align}\n$$\n\n$$ \n\\begin{align}\nPr(y = 0) &= (1 - d) ^ {\\text{effort}}p + 1 - p \\\\\n{logit}(p) &= \\alpha \n\\end{align}\n$$\n\nvery simple occupancy model that controls for effort\n\n$$\ny = \n\\begin{cases}\n y = 1, wp \\\\\n y = 0, (1 - w)p + 1 - p\n\\end{cases}\n$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncurve(1 - (1 - .4)^x, xlim = c(0, 20))\nabline(v = 1, h = .4)\n```\n:::\n\n\nThis can also be done with the cloglog link\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfake_data <- tibble(sample_id = 1:200,\n                    real_pres = rbinom(n = length(sample_id),\n                                       p = .7,\n                                       size = 1),\n                    sample_size = round(\n                      runif(\n                        n = length(sample_id),\n                        min = 2, max = 40)\n                    )) |>\n  rowwise() |> \n  mutate(pa = list(rbinom(n = sample_size,\n                          p = .1,\n                          size = 1)),\n         abd = sum(pa) * real_pres)\n\nggplot(fake_data, aes(x = sample_size, y = abd)) + geom_point()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfake_data |> \n  mutate(prop = abd/sample_size) |> \n  pull(prop) |> mean()\n```\n:::\n\n\n## validate a simple Stan model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(cmdstanr)\n\nsimple_occ_logit <- cmdstan_model(\"posts/2023-02-08-occupancy-in-time/simple_occ_logit.stan\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_list <- list(N = nrow(fake_data),\n                  y = as.numeric(fake_data$abd>0),\n                  sample_size = fake_data$sample_size)\ndata_list\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_result <- simple_occ_logit$sample(data = data_list)\n\nmodel_result$summary()\n```\n:::\n\n\nhttps://mc-stan.org/users/documentation/case-studies/dorazio-royle-occupancy.html\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}